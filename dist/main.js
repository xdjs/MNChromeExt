"use strict";(()=>{function x(t){console.log(t),console.log(t.bio);let n=document.getElementById("title"),e=document.getElementById("bio"),o=document.getElementById("links-title"),s=document.getElementById("links-list"),r=document.getElementById("MN-link");r.textContent=document.createElement("a"),t.id?r.href="https://www.musicnerd.xyz/artist/"+t.id:r.href="https://www.musicnerd.xyz",r.className="flex items-center gap-3 hover:bg-gray-50 p-2 rounded",r.target="_blank";let i=document.createElement("p");if(i.className="text-sm text-gray-500 truncate",t.id?i.textContent="View on MusicNerd.xyz":i.textContent="Add them on MusicNerd.xyz",r.appendChild(i),n.textContent=t.name??"Sorry, we don't know this artist!",e.textContent=t.bio??"No bio Available",t.id||(e.textContent=""),o&&(t.id?(o.textContent=`${t.name??"Artist"}'s Links`,o.style.display="block"):o.style.display="none"),s)if(s.innerHTML="",Array.isArray(t.links)&&t.links.length>0)t.links.forEach(a=>{let c=document.createElement("li"),u=document.createElement("a");u.href=a.url??a.href??"#",u.target="_blank",u.className="flex items-center gap-3 hover:bg-gray-50 p-2 rounded";let l=document.createElement("p");l.className="font-semibold uppercase text-sm text-blue-600 hover:text-blue-800",l.textContent=a.label??a.title??"Link";let y=document.createElement("p");y.className="text-sm text-gray-500 truncate",a.platform_type_list&&a.platform_type_list.includes("social")?y.textContent=t[a.label]??a.url??a.href??"":y.textContent="";let b=document.createElement("img");b.src=a.image,b.alt="Artist Photo",b.className="w-8 h-8 rounded-full object-cover flex-shrik-0";let w=document.createElement("div");w.className="flex-1 min-w-0",w.appendChild(l),w.appendChild(y),u.appendChild(b),u.appendChild(w),c.appendChild(u),s.appendChild(c)});else if(t.id){let a=document.createElement("li");a.className="text-gray-400 text-sm",a.textContent="No links available",s.appendChild(a)}else{let a=document.createElement("li");a.className="text-gray-400 text-sm",a.textContent="",s.appendChild(a)}console.log(n),console.log(e)}function h(t){let n=document.getElementById("title"),e=document.getElementById("bio");switch(t){case"noArtist":{n.textContent="Sorry, we don't know this artist!",e.textContent="If you'd like, you can add them on MusicNerd!";let o=document.getElementById("MN-link");o.textContent=document.createElement("a"),o.className="flex items-center gap-3 hover:bg-gray-50 p-2 rounded",o.target="_blank",o.href="https://www.musicnerd.xyz";let s=document.createElement("p");s.className="text-sm text-gray-500 truncate",s.textContent="Add them on MusicNerd.xyz",o.appendChild(s);break}case"noData":{n.textContent="We don't see anything playing!",e.textContent="Start playing something to get started!";break}case"notInjected":{n.textContent="Our system isn't hooked up yet.",e.textContent=`If you've just installed or reloaded the application, 
 please restart your browser or reload the page.`;break}case"default":{n.textContent="An error has occured.";break}default:{n.textContent="An error has occured.";break}}console.log(n),console.log(e)}var f=[],d=0;function C(t){if(console.log("renderArtists called with:",t),f=t,t.length===1){console.log("Single artist detected, using regular UI"),q(),x(t[0]);return}console.log("Multiple artists detected, showing tabs"),U(t),I()}function U(t){let n=document.getElementById("artist-tabs"),e=document.getElementById("tabs-list");e.innerHTML="",t.forEach((o,s)=>{let r=document.createElement("button");r.className=`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${s===d?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`;let i=o.name||"Unknown artist";r.textContent=o.isPrimary?`${i} \u2B50`:i,r.addEventListener("click",()=>A(s)),e.appendChild(r)}),n.style.display="block"}function q(){let t=document.getElementById("artist-tabs");t.style.display="none"}function A(t){t===d||!f[t]||(d=t,z(),I())}function z(){document.querySelectorAll("#tabs-list button").forEach((n,e)=>{e===d?n.className="px-4 py-2 text-sm font-medium border-b-2 border-blue-500 text-blue-600 bg-blue-50 transition-colors":n.className="px-4 py-2 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 transition-colors"})}function I(){let t=f[d];t&&x(t)}document.addEventListener("keydown",t=>{f.length<=1||(t.key==="ArrowLeft"&&d>0?A(d-1):t.key==="ArrowRight"&&d<f.length-1&&A(d+1))});function v(t,n="name"){return`${n}:${t.toLowerCase()}`}async function k(t,n,e="name"){let o=v(t,e),s={data:n,timestamp:Date.now(),links:n.links||[]};console.log(`cached artist: ${JSON.stringify(s)}`),await chrome.storage.local.set({[`cache_${o}`]:s})}async function E(t,n="name"){let e=v(t,n),s=(await chrome.storage.local.get(`cache_${e}`))[`cache_${e}`];return s?Date.now()-s.timestamp>18e4?(await chrome.storage.local.remove(`cache_${e}`),null):s.data:null}async function N(t,n){let e=`video_${t}`;await chrome.storage.local.set({[`cache_${e}`]:{data:n,timestamp:Date.now()}})}async function $(t){let n=`video_${t}`,o=(await chrome.storage.local.get(`cache_${n}`))[`cache_${n}`];return o?Date.now()-o.timestamp>18e4?(await chrome.storage.local.remove(`cache_${n}`),null):o.data:null}function S(t){let n=(t.title||"").toLowerCase().trim();return`${(t.channel||"").toLowerCase().trim()}_${n}`.replace(/[^a-z0-9_]/g,"")}async function _(t){let n=S(t),o=(await chrome.storage.local.get(`cache_media_${n}`))[`cache_media_${n}`];return console.log(`grabbing cache with key: cache is  ${o}`),o?Date.now()-o.timestamp>18e4?(await chrome.storage.local.remove(`cache_media_${n}`),null):o.data:null}async function T(t,n){let e=S(t);await chrome.storage.local.set({[`cache_media_${e}`]:{data:n,timestamp:Date.now(),originalMediaData:t}}),console.log(`caching data: ${e}`)}var m="https://mn-chrome-ext.vercel.app";async function B(t){console.log("fetchArtist called with:",t);let n=await E(t.id,"id");if(n)return console.log("[DEBUG: returning cached "+JSON.stringify(n)+"]"),n;let e=`${m}/api/artist/by-id/${encodeURIComponent(t.id)}`;console.log("Fetching artist from:",e);let o=await fetch(e),s=o.ok?await o.json():null;if(console.log("Artist API response:",s),s&&s.id){let r=`${m}/api/urlmap/links/${encodeURIComponent(s.id)}`,i=await fetch(r);s.links=i.ok?await i.json():[],k(t.id,s,"id")}return s}async function L(t){let n=await E(t.channel);if(n)return n;console.log("fetchArtistFromName called with:",t);let e=`${m}/api/artist/batch`;console.log("Fetching artist from (batch-single):",t.channel);let o=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({usernames:[t.channel]})}),s=o.ok?await o.json():{artists:[null]},r=Array.isArray(s.artists)?s.artists[0]:null;if(console.log("Artist API response:",r),r&&!r.error&&r.id){let i=`${m}/api/urlmap/links/${encodeURIComponent(r.id)}`,a=await fetch(i);r.links=a.ok?await a.json():[],k(t.channel,r)}return r}async function p(t){let n=`${m}/api/openai/extract-multiple-artists`,o=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(typeof t=="string"?{title:t}:{data:t})});return o.ok?(await o.json()).artists||[]:[]}async function g(t){if(!t||t.length===0)return[];console.log("fetchMultipleArtistsByNames called with:",t);let n=`${m}/api/artist/batch`,e=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({usernames:t})});if(!e.ok)return console.error("Batch artist fetch failed:",e.status,e.statusText),[];let o=await e.json();return console.log("Batch artist API response:",o),o.artists||[]}function P(t){return new Promise(n=>{chrome.tabs.sendMessage(t,{type:"GET_YT_INFO"},n)})}async function R(t){try{let e=(await chrome.tabs.query({})).map(s=>new Promise(r=>{chrome.tabs.sendMessage(s.id,{action:"checkMediaSession"},i=>{chrome.runtime.lastError?r(null):r(i)})})),o=await Promise.all(e);return console.log(o),o.find(s=>s!=null&&s!==void 0)}catch(n){console.error("Error getting media session results",n)}}async function j(t){return new Promise(n=>{chrome.tabs.sendMessage(t,{action:"checkMediaSession"},e=>{chrome.runtime.lastError?n(!1):n(!0)})})}function M(t){return[/\bft\.?\s/i,/\bfeat\.?\s/i,/\bfeaturing\b/i,/\bwith\b/i,/\sx\s/i,/\s&\s/,/\s\+\s/,/\bvs\.?\b/i,/\b(collab|collaboration)\b/i,/\bremix by\b/i,/\bprod\.? by\b/i].some(e=>e.test(t))}function D(t){let n=[/v=([^&]+)/,/youtu\.be\/([^?&]+)/,/music\.youtube\.com\/watch\?v=([^&]+)/];for(let e of n){let o=t.match(e);if(o)return o[1]}return null}async function F(t){let[n]=await chrome.tabs.query({active:!0,currentWindow:!0}),e=null;if(n?.url&&(e=D(n.url),e)){let r=await $(e);if(r)return console.log("Returning cached video result for:",e),r}let o=await P(t),s=[];if(o?.id){console.log("[DEBUG] "+o.id);let r=await B(o);if(r.id){if(s.push({...r,isPrimary:!0}),console.log("[DEBUG] Youtube lookup successful: "+s),M(o.title)){let a=(await p(o)).filter(c=>c.toLowerCase()!==r.name.toLowerCase());if(a.length>0){let u=(await g(a)).filter(l=>l&&!l.error&&l.id).map(l=>({...l,isPrimary:!1}));s.push(...u)}}if(s.length>0)return e&&await N(e,s),s}}if(!o?.title||s.length===0){console.log("falling back to AI");let r=await p(o);if(console.log(r),r.length>0){let a=(await g(r)).filter(c=>c&&!c.error&&c.id).map(c=>({...c,isPrimary:!1}));s.push(...a)}}return e&&await N(e,s),s}async function O(){let t=await R();if(console.log("Media session info:",t),!t)return console.log("No media session data available"),"noMediaSession";let n=await _(t);if(n)return console.log("cached result found, returning..."),n;let e=[];if(t?.title){let o=await L(t);if(o&&!o.error&&o.id){if(e.push({...o,isPrimary:!0}),M(t.title)){let r=(await p(t)).filter(i=>i.toLowerCase()!==o.name.toLowerCase());if(r.length>0){let a=(await g(r)).filter(c=>c&&!c.error&&c.id).map(c=>({...c,isPrimary:!1}));e.push(...a)}}if(e.length>0)return e}}if(!t?.title&&e.length===0){console.log("falling back to AI");let o=await p(t);if(console.log(o),o.length>0){let r=(await g(o)).filter(i=>i&&!i.error&&i.id).map(i=>({...i,isPrimary:!1}));e.push(...r),T(t,e)}}return console.log("returning artists..."),e}document.addEventListener("DOMContentLoaded",async()=>{let[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!await j(t.id)){h("notInjected");return}if(!t.url.includes("youtube.com/watch")&&!t.url.includes("music.youtube.com")){let e=await O();if(e.length>0&&e!="noMediaSession")C(e);else switch(e){case"noMediaSession":{h("noData");break}case void 0:{h("noArtist");break}}return}let n=await F(t.id);console.log("rendering multiple artists"),n.length>0?C(n):h("noArtist")});})();
