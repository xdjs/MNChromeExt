"use strict";(()=>{function k(t){let e=t.spotifyData?.data?.images?.[0]?.url;console.log(t.bio);let o=document.getElementById("title"),n=document.getElementById("bio"),s=document.getElementById("links-title"),a=document.getElementById("links-list");if(e){console.log(e);let r=document.getElementById("card");r.style.backgroundImage=`
        radial-gradient(circle, transparent, rgba(255,255,255,1.0)),
        url(${e})
      `,r.style.backgroundSize="cover",r.style.backgroundPosition="center",r.style.backgroundRepeat="no-repeat",r.style.minHeight="580px"}else console.log("no image URL detected");let c=document.getElementById("MN-link");c.textContent=document.createElement("a"),t.id?c.href="https://www.musicnerd.xyz/artist/"+t.id:c.href="https://www.musicnerd.xyz",c.className="flex items-center gap-3 hover:bg-gray-50 p-2 rounded",c.target="_blank";let l=document.createElement("p");if(l.className="text-sm text-gray-500 truncate",t.id?l.textContent="View on MusicNerd.xyz":l.textContent="Add them on MusicNerd.xyz",c.appendChild(l),o.textContent=t.name??"Sorry, we don't know this artist!",n.textContent=typeof t.bio=="string"?t.bio:t.bio?.bio??t.bio?.text??"No bio Available",t.bio&&(o.appendChild(n),o.style.backgroundColor="rgba(255, 255, 255, 0.5)",o.style.borderRadius="8px",o.style.padding="16px",o.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.1)",o.style.backdropFilter="blur(5px)",n.style.textTransform="none"),t.id||(n.textContent=""),s&&(t.id?(s.textContent=`${t.name??"Artist"}'s Links`,s.style.display="block"):s.style.display="none"),a)if(a.innerHTML="",Array.isArray(t.links)&&t.links.length>0)t.links.forEach(r=>{let p=document.createElement("li"),i=document.createElement("a");i.href=r.url??r.href??"#",i.target="_blank",i.style.backgroundColor="rgba(255, 255, 255, 0.5)",i.style.borderRadius="8px",i.style.padding="8px",i.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.1)",i.style.backdropFilter="blur(5px)",i.style.marginBottom="8px",i.className="flex items-center gap-3 hover:bg-gray-50 p-2 rounded",a.style.gap="4px",i.addEventListener("mouseenter",()=>{i.style.transform="scale(1.1)",i.style.transition="transform 0.3s ease"}),i.addEventListener("mouseleave",()=>{i.style.transform="scale(1.0)",i.style.transition="transform 0.3s ease"});let h=document.createElement("p");h.className="font-semibold uppercase text-sm text-blue-600 hover:text-blue-800",h.textContent=r.label??r.title??"Link";let u=document.createElement("p");u.className="text-sm text-gray-500 truncate",r.platform_type_list&&r.platform_type_list.includes("social")?u.textContent=t[r.label]??r.url??r.href??"":u.textContent="";let m=document.createElement("img");m.src=r.image,m.alt="Artist Photo",m.className="w-8 h-8 rounded-full object-cover flex-shrik-0";let f=document.createElement("div");f.className="flex-1 min-w-0",f.appendChild(h),f.appendChild(u),i.appendChild(m),i.appendChild(f),p.appendChild(i),a.appendChild(p)});else if(t.id){let r=document.createElement("li");r.className="text-gray-400 text-sm",r.textContent="No links available",a.appendChild(r)}else{let r=document.createElement("li");r.className="text-gray-400 text-sm",r.textContent="",a.appendChild(r)}console.log(o),console.log(n)}function y(t){let e=document.getElementById("title"),o=document.getElementById("bio");switch(t){case"noArtist":{e.textContent="Sorry, we don't know this artist!",o.textContent="If you'd like, you can add them on MusicNerd!";let n=document.getElementById("MN-link");n.textContent=document.createElement("a"),n.className="flex items-center gap-3 hover:bg-gray-50 p-2 rounded",n.target="_blank",n.href="https://www.musicnerd.xyz";let s=document.createElement("p");s.className="text-sm text-gray-500 truncate",s.textContent="Add them on MusicNerd.xyz",n.appendChild(s);break}case"noData":{e.textContent="We don't see anything playing!",o.textContent="Start playing something to get started!";break}case"notInjected":{e.textContent="Our system isn't hooked up yet.",o.textContent=`If you've just installed or reloaded the application, 
 please restart your browser or reload the page.`;break}case"default":{e.textContent="An error has occured.";break}default:{e.textContent="An error has occured.";break}}console.log(e),console.log(o)}var g=[],d=0;function C(t){if(console.log("renderArtists called with:",t),g=t,t.length===1){console.log("Single artist detected, using regular UI"),q(),k(t[0]);return}console.log("Multiple artists detected, showing tabs"),O(t),I()}function O(t){let e=document.getElementById("artist-tabs"),o=document.getElementById("tabs-list");o.innerHTML="",t.forEach((n,s)=>{let a=document.createElement("button");a.className=`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${s===d?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`;let c=n.name||"Unknown artist";a.textContent=n.isPrimary?`${c} \u2B50`:c,a.addEventListener("click",()=>A(s)),a.style.background=`linear-gradient(to bottom, 
        rgba(255,255,255,0) 0%, 
        rgba(255,255,255,0.2) 30%, 
        rgba(255,255,255,0.8) 80%, 
        rgba(255,255,255,1) 100%
        )`,a.style.padding="8px",o.appendChild(a)}),e.style.display="flex",e.style.overflowX="auto",e.style.whiteSpace="nowrap"}function q(){let t=document.getElementById("artist-tabs");t.style.display="none"}function A(t){t===d||!g[t]||(d=t,J(),I())}function J(){document.querySelectorAll("#tabs-list button").forEach((e,o)=>{o===d?e.className="px-4 py-2 text-sm font-medium border-b-2 border-blue-500 text-blue-600 bg-blue-50 transition-colors":e.className="px-4 py-2 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 transition-colors",e.style.background=`linear-gradient(to bottom, 
    rgba(255,255,255,0) 0%, 
    rgba(255,255,255,0.2) 30%, 
    rgba(255,255,255,0.8) 80%, 
    rgba(255,255,255,1) 100%
    )`,e.style.padding="8px"})}function I(){let t=g[d];t&&k(t)}document.addEventListener("keydown",t=>{g.length<=1||(t.key==="ArrowLeft"&&d>0?A(d-1):t.key==="ArrowRight"&&d<g.length-1&&A(d+1))});function N(t,e="name"){return`${e}:${t.toLowerCase()}`}async function S(t,e,o="name"){let n=N(t,o),s={data:e,timestamp:Date.now(),links:e.links||[]};console.log(`cached artist: ${JSON.stringify(s)}`),await chrome.storage.local.set({[`cache_${n}`]:s})}async function v(t,e="name"){let o=N(t,e),s=(await chrome.storage.local.get(`cache_${o}`))[`cache_${o}`];return s?Date.now()-s.timestamp>18e4?(await chrome.storage.local.remove(`cache_${o}`),null):s.data:null}async function E(t,e){let o=`video_${t}`;await chrome.storage.local.set({[`cache_${o}`]:{data:e,timestamp:Date.now()}})}async function $(t){let e=`video_${t}`,n=(await chrome.storage.local.get(`cache_${e}`))[`cache_${e}`];return n?Date.now()-n.timestamp>18e4?(await chrome.storage.local.remove(`cache_${e}`),null):n.data:null}function M(t){let e=(t.title||"").toLowerCase().trim();return`${(t.channel||"").toLowerCase().trim()}_${e}`.replace(/[^a-z0-9_]/g,"")}async function R(t){let e=M(t),n=(await chrome.storage.local.get(`cache_media_${e}`))[`cache_media_${e}`];return console.log(`grabbing cache with key: cache is  ${n}`),n?Date.now()-n.timestamp>18e4?(await chrome.storage.local.remove(`cache_media_${e}`),null):n.data:null}async function T(t,e){let o=M(t);await chrome.storage.local.set({[`cache_media_${o}`]:{data:e,timestamp:Date.now(),originalMediaData:t}}),console.log(`caching data: ${o}`)}var b="https://mn-chrome-ext.vercel.app";async function _(t){console.log("fetchArtist called with:",t);let e=await v(t.id,"id");if(e)return console.log("[DEBUG: returning cached "+JSON.stringify(e)+"]"),e;let o=`${b}/api/artist/by-id/${encodeURIComponent(t.id)}`;console.log("Fetching artist from:",o);let n=await fetch(o),s=n.ok?await n.json():null;if(console.log("Artist API response:",s),s&&s.id){let a=`${b}/api/urlmap/links/${encodeURIComponent(s.id)}`,c=await fetch(a);s.links=c.ok?await c.json():[];try{let l=`https://api.musicnerd.xyz/api/getSpotifyData?spotifyId=${s.spotify}`,r=await fetch(l);r.ok&&(s.spotifyData=await r.json())}catch{s.spotifyData=null}S(t.id,s,"id")}return s}async function w(t){let e=`${b}/api/openai/extract-multiple-artists`,n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(typeof t=="string"?{title:t}:{data:t})});return n.ok?(await n.json()).artists||[]:[]}async function x(t){if(!t||t.length===0)return[];console.log("fetchMultipleArtistsByNames called with:",t);let o=await fetch("https://api.musicnerd.xyz/api/searchArtists/batch",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({query:{artists:t}})});if(!o.ok)return console.error("Batch artist fetch failed:",o.status,o.statusText),[];let n=await o.json(),s=Array.isArray(n.results)?n.results:[];console.log("Batch artist API response:",n);let a=s.filter(l=>l&&l.id&&l.matchScore==0);return await Promise.all(a.map(async l=>{if(!l||!l.id)return l;let r=`${b}/api/urlmap/links/${encodeURIComponent(l.id)}`,p=`https://api.musicnerd.xyz/api/artistBio/${encodeURIComponent(l.id)}`,i=`https://api.musicnerd.xyz/api/getSpotifyData?spotifyId=${l.spotify}`,[h,u,m]=await Promise.all([fetch(r),fetch(p,{method:"GET",headers:{Accept:"application/json"}}),fetch(i,{method:"GET",headers:{Accept:"application/json"}})]),f=h.ok?await h.json():[],z=u.ok?await u.json():null,F=m.ok?await m.json():null;return{...l,links:f,bio:z,spotifyData:F}}))}function j(t){return new Promise(e=>{chrome.tabs.sendMessage(t,{type:"GET_YT_INFO"},e)})}async function B(t){try{let o=(await chrome.tabs.query({})).map(s=>new Promise(a=>{chrome.tabs.sendMessage(s.id,{action:"checkMediaSession"},c=>{chrome.runtime.lastError?a(null):a(c)})})),n=await Promise.all(o);return console.log(n),n.find(s=>s!=null&&s!==void 0)}catch(e){console.error("Error getting media session results",e)}}async function L(t){return new Promise(e=>{chrome.tabs.sendMessage(t,{action:"checkMediaSession"},o=>{chrome.runtime.lastError?e(!1):e(!0)})})}function P(t){return[/\bft\.?\s/i,/\bfeat\.?\s/i,/\bfeaturing\b/i,/\bwith\b/i,/\sx\s/i,/\s&\s/,/\s\+\s/,/\bvs\.?\b/i,/\b(collab|collaboration)\b/i,/\bremix by\b/i,/\bprod\.? by\b/i].some(o=>o.test(t))}function Y(t){let e=[/v=([^&]+)/,/youtu\.be\/([^?&]+)/,/music\.youtube\.com\/watch\?v=([^&]+)/];for(let o of e){let n=t.match(o);if(n)return n[1]}return null}async function U(t){let[e]=await chrome.tabs.query({active:!0,currentWindow:!0}),o=null;if(e?.url&&(o=Y(e.url),o)){let a=await $(o);if(a)return console.log("Returning cached video result for:",o),a}let n=await j(t),s=[];if(n?.id){console.log("[DEBUG] "+n.id);let a=await _(n);if(a.id){if(s.push({...a,isPrimary:!0}),console.log("[DEBUG] Youtube lookup successful: "+s),P(n.title)){let l=(await w(n)).filter(r=>r.toLowerCase()!==a.name.toLowerCase());if(l.length>0){let p=(await x(l)).filter(i=>i&&!i.error&&i.id).map(i=>({...i,isPrimary:!1}));s.push(...p)}}if(s.length>0)return o&&await E(o,s),s}}if(!n?.title||s.length===0){console.log("falling back to AI");let a=await w(n);if(console.log(a),a.length>0){let l=(await x(a)).filter(r=>r&&!r.error&&r.id).map(r=>({...r,isPrimary:!1}));s.push(...l)}}return o&&await E(o,s),s}async function D(){let t=await B();if(console.log("Media session info:",t),!t)return console.log("No media session data available"),"noMediaSession";let e=await R(t);if(e)return console.log("cached result found, returning..."),e;let o=[],n=await w(t);if(console.log(n),n.length>0){let a=(await x(n)).filter(c=>c&&!c.error&&c.id).map(c=>({...c,isPrimary:!1}));o.push(...a),T(t,o)}return console.log("returning artists..."),o}document.addEventListener("DOMContentLoaded",async()=>{let[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!await L(t.id)){y("notInjected");return}if(!t.url.includes("youtube.com/watch")&&!t.url.includes("music.youtube.com")){let o=await D();if(console.log("found artists, rendering: "+o.length+" artists"),o.length>0&&o!="noMediaSession")C(o);else switch(o){case"noMediaSession":{y("noData");break}case void 0:{console.log("[ERROR] no artist returned for mediaSession"),y("noArtist");break}}return}let e=await U(t.id);console.log("rendering multiple artists"),console.log(e),e.length>0?C(e):(console.log("[ERROR] no artists detected, showing error"),y("noArtist"))});})();
