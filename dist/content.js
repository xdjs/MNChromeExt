"use strict";(()=>{function r(t){let e=[/v=([^&]+)/,/youtu\.be\/([^?&]+)/,/embed\/([^?&]+)/,/music\.youtube\.com\/watch\?v=([^&]+)/];for(let n of e){let o=t.match(n);if(o)return console.log(o[1]),o[1]}return null}var s="AIzaSyByzNFPU1XR0gm_kfd2EoThjYlVeezmup8";async function a(t){let e=`https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${t}&key=${s}`,o=await(await fetch(e)).json();if(!o.items?.length)return null;let i=o.items[0].snippet;return console.log(i.channelId),{title:i.title,channel:i.channelTitle,description:i.description,tags:i.tags,id:i.channelId}}function l(){let t,e;location.hostname==="music.youtube.com"?(t=document.querySelector(".title.ytmusic-player-bar"),e=document.querySelector(".byline.ytmusic-player-bar a")):(t=document.querySelector("h1.title yt-formatted-string")||document.querySelector("ytd-watch-metadata h1"),e=document.querySelector("#owner-name a")||document.querySelector("ytd-channel-name#channel-name a"));let n=document.querySelector("#description"),o=document.querySelector('a.yt-simple-endpoint.style-scope.yt-formatted-string[href^="/@"]');return console.log("[YT-EXT] titleEl",t,"channelEl",e),t&&console.log("Title: ",t.textContent.trim()),e&&console.log("Channel: ",e.textContent.trim()),e&&t&&n?(console.log(o?.textContent?.trim()),{videoTitle:t.textContent.trim(),channel:e.textContent.trim(),description:n?.textContent.trim(),username:o?.textContent.trim()}):(console.log("no info found"),null)}function c(){if(!("mediaSession"in navigator))return console.log("Media Session API not supported"),null;let t=navigator.mediaSession.metadata,e=navigator.mediaSession.playbackState;return console.log("Media Session Debug:",{metadata:t,playbackState:e,hasMetadata:!!t,url:window.location.href}),e==="paused"?null:t?{title:t.title||"",channel:t.artist||"",album:t.album||"",source:"mediaSession",playbackState:e,url:window.location.href,domain:window.location.hostname}:(console.log("No useful media session data (no title or artist)"),null)}console.log("[YT-EXT] content script injected");chrome.runtime.onMessage.addListener((t,e,n)=>{if(t.type==="GET_YT_INFO"){let o=r(location.href);if(!o)return n(null),!0;a(o).then(i=>n(i)).catch(i=>{console.error("[YT-EXT] Fetch error",i),n(null)})}return t.type==="SCRAPE_YT_INFO"&&n(l()),!0});chrome.runtime.onMessage.addListener((t,e,n)=>{t.action==="checkMediaSession"&&n(c())});})();
