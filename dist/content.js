"use strict";(()=>{var hr=Object.defineProperty;var yr=(t,e,r)=>e in t?hr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var i=(t,e,r)=>yr(t,typeof e!="symbol"?e+"":e,r);function K(t){let e=[/v=([^&]+)/,/youtu\.be\/([^?&]+)/,/embed\/([^?&]+)/,/music\.youtube\.com\/watch\?v=([^&]+)/];for(let r of e){let n=t.match(r);if(n)return console.log(n[1]),n[1]}return null}var gr="AIzaSyByzNFPU1XR0gm_kfd2EoThjYlVeezmup8";async function U(t){let e=`https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${t}&key=${gr}`,n=await(await fetch(e)).json();if(!n.items?.length)return null;let o=n.items[0].snippet;return console.log(o.channelId),{title:o.title,channel:o.channelTitle,description:o.description,tags:o.tags,id:o.channelId}}function qe(){let t,e;location.hostname==="music.youtube.com"?(t=document.querySelector(".title.ytmusic-player-bar"),e=document.querySelector(".byline.ytmusic-player-bar a")):(t=document.querySelector("h1.title yt-formatted-string")||document.querySelector("ytd-watch-metadata h1"),e=document.querySelector("#owner-name a")||document.querySelector("ytd-channel-name#channel-name a"));let r=document.querySelector("#description"),n=document.querySelector('a.yt-simple-endpoint.style-scope.yt-formatted-string[href^="/@"]');return console.log("[YT-EXT] titleEl",t,"channelEl",e),t&&console.log("Title: ",t.textContent.trim()),e&&console.log("Channel: ",e.textContent.trim()),e&&t&&r?(console.log(n?.textContent?.trim()),{videoTitle:t.textContent.trim(),channel:e.textContent.trim(),description:r?.textContent.trim(),username:n?.textContent.trim()}):(console.log("no info found"),null)}function De(t,e="name"){return`${e}:${t.toLowerCase()}`}async function pe(t,e,r="name"){let n=De(t,r),o={data:e,timestamp:Date.now(),links:e.links||[]};console.log(`cached artist: ${JSON.stringify(o)}`),await chrome.storage.local.set({[`cache_${n}`]:o})}async function fe(t,e="name"){let r=De(t,e),o=(await chrome.storage.local.get(`cache_${r}`))[`cache_${r}`];return o?Date.now()-o.timestamp>18e4?(await chrome.storage.local.remove(`cache_${r}`),null):o.data:null}async function $e(t,e){let r=`video_${t}`;await chrome.storage.local.set({[`cache_${r}`]:{data:e,timestamp:Date.now()}})}async function Ke(t){let e=`video_${t}`,n=(await chrome.storage.local.get(`cache_${e}`))[`cache_${e}`];return n?Date.now()-n.timestamp>18e4?(await chrome.storage.local.remove(`cache_${e}`),null):n.data:null}function Ee(t){let e=(t.title||"").toLowerCase().trim();return`${(t.channel||"").toLowerCase().trim()}_${e}`.replace(/[^a-z0-9_]/g,"")}async function Fe(t){let e=Ee(t),n=(await chrome.storage.local.get(`cache_media_${e}`))[`cache_media_${e}`];return console.log(`grabbing cache with key: cache is  ${n}`),n?Date.now()-n.timestamp>18e4?(await chrome.storage.local.remove(`cache_media_${e}`),null):n.data:null}async function he(t,e){let r=Ee(t);await chrome.storage.local.set({[`cache_media_${r}`]:{data:e,timestamp:Date.now(),originalMediaData:t}}),console.log(`caching data: ${r}`)}var z="https://mn-chrome-ext.vercel.app";async function Le(t){console.log("fetchArtist called with:",t);let e=await fe(t.id,"id");if(e)return console.log("[DEBUG: returning cached "+JSON.stringify(e)+"]"),e;let r=`${z}/api/artist/by-id/${encodeURIComponent(t.id)}`;console.log("Fetching artist from:",r);let n=await fetch(r),o=n.ok?await n.json():null;if(console.log("Artist API response:",o),o&&o.id){let c=`${z}/api/urlmap/links/${encodeURIComponent(o.id)}`,m=await fetch(c);o.links=m.ok?await m.json():[],pe(t.id,o,"id")}return o}async function Ve(t){let e=await fe(t.channel);if(e)return e;console.log("fetchArtistFromName called with:",t);let r=`${z}/api/artist/batch`;console.log("Fetching artist from (batch-single):",t.channel);let n=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({usernames:[t.channel]})}),o=n.ok?await n.json():{artists:[null]},c=Array.isArray(o.artists)?o.artists[0]:null;if(console.log("Artist API response:",c),c&&!c.error&&c.id){let m=`${z}/api/urlmap/links/${encodeURIComponent(c.id)}`,d=await fetch(m);c.links=d.ok?await d.json():[],pe(t.channel,c)}return c}async function E(t){let e=`${z}/api/openai/extract-multiple-artists`,n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(typeof t=="string"?{title:t}:{data:t})});return n.ok?(await n.json()).artists||[]:[]}async function F(t){if(!t||t.length===0)return[];console.log("fetchMultipleArtistsByNames called with:",t);let e=`${z}/api/artist/batch`,r=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({usernames:t})});if(!r.ok)return console.error("Batch artist fetch failed:",r.status,r.statusText),[];let n=await r.json();return console.log("Batch artist API response:",n),n.artists||[]}function ye(t){return[/\bft\.?\s/i,/\bfeat\.?\s/i,/\bfeaturing\b/i,/\bwith\b/i,/\sx\s/i,/\s&\s/,/\s\+\s/,/\bvs\.?\b/i,/\b(collab|collaboration)\b/i,/\bremix by\b/i,/\bprod\.? by\b/i].some(r=>r.test(t))}async function wr(){console.log("preloading...");try{let t=A();if(!t||!t.title){console.log("No media session data to preload");return}let e=await Fe(t);if(e){console.log("Preload: cached result already exists: "+e);return}let r=[];if(t.title){let n=await Ve(t);if(n&&!n.error&&n.id){if(r.push({...n,isPrimary:!0}),ye(t.title)){let c=(await E(t)).filter(m=>m.toLowerCase()!==n.name.toLowerCase());if(c.length>0){let d=(await F(c)).filter(u=>u&&!u.error&&u.id).map(u=>({...u,isPrimary:!1}));r.push(...d)}}if(r.length>0)return await he(t,r),console.log("Successfully preloaded and cached artist data via name lookup"),r}}if(t.title&&r.length===0){console.log("Preload: falling back to AI extraction");let n=await E(t);if(console.log("AI extracted names:",n),n.length>0){let c=(await F(n)).filter(m=>m&&!m.error&&m.id).map(m=>({...m,isPrimary:!1}));r.push(...c)}await he(t,r)}return r}catch(t){return console.error("Preload error:",t),[]}}async function br(){let t=K(window.location.href);if(!t||await Ke(t))return;let r=await U(t);if(!r)return;let n=[],o=await Le({id:r.id,title:r.title,channel:r.channel});if(o&&!o.error&&(n.push({...o,isPrimary:!0}),ye(r.title))){console.log("[preload] using AI for collaborators");let m=(await E(r)).filter(d=>d.toLowerCase()!==o.name.toLowerCase());if(m.length>0){let u=(await F(m)).filter(s=>s&&!s.error&&s.id).map(s=>({...s,isPrimary:!1}));n.push(...u)}}if(n.length===0&&r.title){console.log("[Preload] falling back to AI");let c=await E(r);if(c.length>0){let d=(await F(c)).filter(u=>u&&!u.error&&u.id).map(u=>({...u,isPrimary:!1}));n.push(...d)}}return n.length>0&&console.log("Successfully preloaded YouTube data"),await $e(t,n),n}async function Oe(){try{let t=K(window.location.href);if(t)return console.log("preloading youtube"),await br(t);let e=A();return e&&e.title?(console.log("preloading media session"),await wr(e)):(console.log("No preloadable content found"),[])}catch(t){return console.error("Preload error:",t),[]}}var l=Symbol.for("drizzle:entityKind"),kr=Symbol.for("drizzle:hasOwnEntityKind");function b(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,l))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=t.constructor;if(r)for(;r;){if(l in r&&r[l]===e[l])return!0;r=Object.getPrototypeOf(r)}return!1}var je;je=l;var T=class{constructor(e,r){i(this,"name");i(this,"primary");i(this,"notNull");i(this,"default");i(this,"defaultFn");i(this,"onUpdateFn");i(this,"hasDefault");i(this,"isUnique");i(this,"uniqueName");i(this,"uniqueType");i(this,"dataType");i(this,"columnType");i(this,"enumValues");i(this,"config");this.table=e,this.config=r,this.name=r.name,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType}mapFromDriverValue(e){return e}mapToDriverValue(e){return e}};i(T,je,"Column");var Me;Me=l;var L=class{constructor(e,r,n){i(this,"config");i(this,"$default",this.$defaultFn);i(this,"$onUpdate",this.$onUpdateFn);this.config={name:e,notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}};i(L,Me,"ColumnBuilder");var ge=Symbol.for("drizzle:Name"),we=Symbol.for("drizzle:Schema"),Qe=Symbol.for("drizzle:Columns"),be=Symbol.for("drizzle:OriginalName"),xe=Symbol.for("drizzle:BaseName"),Ue=Symbol.for("drizzle:IsAlias"),ke=Symbol.for("drizzle:ExtraConfigBuilder"),xr=Symbol.for("drizzle:IsDrizzleTable"),Be,Ye,Re,Je,We,Xe,Ze,Ge,He;He=l,Ge=ge,Ze=be,Xe=we,We=Qe,Je=xe,Re=Ue,Ye=ke,Be=xr;var w=class{constructor(e,r,n){i(this,Ge);i(this,Ze);i(this,Xe);i(this,We);i(this,Je);i(this,Re,!1);i(this,Ye);i(this,Be,!0);this[ge]=this[be]=e,this[we]=r,this[xe]=n}};i(w,He,"Table"),i(w,"Symbol",{Name:ge,Schema:we,OriginalName:be,Columns:Qe,BaseName:xe,IsAlias:Ue,ExtraConfigBuilder:ke});var Se=Symbol.for("drizzle:PgInlineForeignKeys"),et,tt,rt,nt,N=class extends(nt=w,rt=l,tt=Se,et=w.Symbol.ExtraConfigBuilder,nt){constructor(){super(...arguments);i(this,tt,[]);i(this,et)}};i(N,rt,"PgTable"),i(N,"Symbol",Object.assign({},w.Symbol,{InlineForeignKeys:Se}));function Sr(t,e,r,n,o=t){let c=new N(t,n,o),m=Object.fromEntries(Object.entries(e).map(([u,s])=>{let p=s,g=p.build(c);return c[Se].push(...p.buildForeignKeys(g,c)),[u,g]})),d=Object.assign(c,m);return d[w.Symbol.Columns]=m,r&&(d[N.Symbol.ExtraConfigBuilder]=r),d}var V=(t,e,r)=>Sr(t,e,r,void 0);var it;it=l;var I=class{constructor(e,r){i(this,"reference");i(this,"_onUpdate","no action");i(this,"_onDelete","no action");this.reference=()=>{let{name:n,columns:o,foreignColumns:c}=e();return{name:n,columns:o,foreignTable:c[0].table,foreignColumns:c}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new k(e,this)}};i(I,it,"PgForeignKeyBuilder");var ot;ot=l;var k=class{constructor(e,r){i(this,"reference");i(this,"onUpdate");i(this,"onDelete");this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}getName(){let{name:e,columns:r,foreignColumns:n}=this.reference(),o=r.map(d=>d.name),c=n.map(d=>d.name),m=[this.table[N.Symbol.Name],...o,n[0].table[N.Symbol.Name],...c];return e??`${m.join("_")}_fk`}};i(k,ot,"PgForeignKey");function st(t){function e(){let{name:r,columns:n,foreignColumns:o}=t;return{name:r,columns:n,foreignColumns:o}}return new I(e)}function B(t,...e){return t(...e)}function O(t){return new R(t)}function Ne(t,e){return`${t[N.Symbol.Name]}_${e.join("_")}_unique`}var at;at=l;var Y=class{constructor(e,r){i(this,"columns");i(this,"nullsNotDistinctConfig",!1);this.name=r,this.columns=e}nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new J(e,this.columns,this.nullsNotDistinctConfig,this.name)}};i(Y,at,"PgUniqueConstraintBuilder");var lt;lt=l;var R=class{constructor(e){i(this,"name");this.name=e}on(...e){return new Y(e,this.name)}};i(R,lt,"PgUniqueOnConstraintBuilder");var ct;ct=l;var J=class{constructor(e,r,n,o){i(this,"columns");i(this,"name");i(this,"nullsNotDistinct",!1);this.table=e,this.columns=r,this.name=o??Ne(this.table,this.columns.map(c=>c.name)),this.nullsNotDistinct=n}getName(){return this.name}};i(J,ct,"PgUniqueConstraint");function ut(t,e,r){for(let n=e;n<t.length;n++){let o=t[n];if(o==="\\"){n++;continue}if(o==='"')return[t.slice(e,n).replace(/\\/g,""),n+1];if(!r&&(o===","||o==="}"))return[t.slice(e,n).replace(/\\/g,""),n]}return[t.slice(e).replace(/\\/g,""),t.length]}function mt(t,e=0){let r=[],n=e,o=!1;for(;n<t.length;){let c=t[n];if(c===","){(o||n===e)&&r.push(""),o=!0,n++;continue}if(o=!1,c==="\\"){n+=2;continue}if(c==='"'){let[u,s]=ut(t,n+1,!0);r.push(u),n=s;continue}if(c==="}")return[r,n+1];if(c==="{"){let[u,s]=mt(t,n+1);r.push(u),n=s;continue}let[m,d]=ut(t,n,!1);r.push(m),n=d}return[r,n]}function dt(t){let[e]=mt(t,1);return e}function Te(t){return`{${t.map(e=>Array.isArray(e)?Te(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var pt,ft,y=class extends(ft=L,pt=l,ft){constructor(){super(...arguments);i(this,"foreignKeyConfigs",[])}array(r){return new W(this.config.name,this,r)}references(r,n={}){return this.foreignKeyConfigs.push({ref:r,actions:n}),this}unique(r,n){return this.config.isUnique=!0,this.config.uniqueName=r,this.config.uniqueType=n?.nulls,this}buildForeignKeys(r,n){return this.foreignKeyConfigs.map(({ref:o,actions:c})=>B((m,d)=>{let u=new I(()=>{let s=m();return{columns:[r],foreignColumns:[s]}});return d.onUpdate&&u.onUpdate(d.onUpdate),d.onDelete&&u.onDelete(d.onDelete),u.build(n)},o,c))}};i(y,pt,"PgColumnBuilder");var ht,yt,f=class extends(yt=T,ht=l,yt){constructor(e,r){r.uniqueName||(r.uniqueName=Ne(e,[r.name])),super(e,r),this.table=e}};i(f,ht,"PgColumn");var gt,wt,W=class extends(wt=y,gt=l,wt){constructor(e,r,n){super(e,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n}build(e){let r=this.config.baseBuilder.build(e);return new _e(e,this.config,r)}};i(W,gt,"PgArrayBuilder");var bt,xt,X=class X extends(xt=f,bt=l,xt){constructor(r,n,o,c){super(r,n);i(this,"size");this.baseColumn=o,this.range=c,this.size=n.size}getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(r){return typeof r=="string"&&(r=dt(r)),r.map(n=>this.baseColumn.mapFromDriverValue(n))}mapToDriverValue(r,n=!1){let o=r.map(c=>c===null?null:b(this.baseColumn,X)?this.baseColumn.mapToDriverValue(c,!0):this.baseColumn.mapToDriverValue(c));return n?o:Te(o)}};i(X,bt,"PgArray");var _e=X;var Ae=Symbol.for("drizzle:isPgEnum");function At(t){return!!t&&typeof t=="function"&&Ae in t&&t[Ae]===!0}var St,Nt,Z=class extends(Nt=y,St=l,Nt){constructor(e,r){super(e,"string","PgEnumColumn"),this.config.enum=r}build(e){return new G(e,this.config)}};i(Z,St,"PgEnumColumnBuilder");var Tt,_t,G=class extends(_t=f,Tt=l,_t){constructor(r,n){super(r,n);i(this,"enum",this.config.enum);i(this,"enumValues",this.config.enum.enumValues);this.enum=n.enum}getSQLType(){return this.enum.enumName}};i(G,Tt,"PgEnumColumn");function Ct(t,e){return Nr(t,e,void 0)}function Nr(t,e,r){let n=Object.assign(o=>new Z(o,n),{enumName:t,enumValues:e,schema:r,[Ae]:!0});return n}var vt;vt=l;var C=class{constructor(e,r,n,o=!1){this._={brand:"Subquery",sql:e,selectedFields:r,alias:n,isWith:o}}};i(C,vt,"Subquery");var zt,It,Ce=class extends(It=C,zt=l,It){};i(Ce,zt,"WithSubquery");var Pt="0.30.10";var ve,ze,qt={startActiveSpan(t,e){return ve?(ze||(ze=ve.trace.getTracer("drizzle-orm",Pt)),B((r,n)=>n.startActiveSpan(t,o=>{try{return e(o)}catch(c){throw o.setStatus({code:r.SpanStatusCode.ERROR,message:c instanceof Error?c.message:"Unknown error"}),c}finally{o.end()}}),ve,ze)):e()}};var j=Symbol.for("drizzle:ViewBaseConfig");var Dt;Dt=l;var Ie=class{};i(Ie,Dt,"FakePrimitiveParam");function Tr(t){return t!=null&&typeof t.getSQL=="function"}function _r(t){let e={sql:"",params:[]};for(let r of t)e.sql+=r.sql,e.params.push(...r.params),r.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...r.typings));return e}var $t;$t=l;var x=class{constructor(e){i(this,"value");this.value=Array.isArray(e)?e:[e]}getSQL(){return new h([this])}};i(x,$t,"StringChunk");var Kt;Kt=l;var v=class v{constructor(e){i(this,"decoder",jt);i(this,"shouldInlineParams",!1);this.queryChunks=e}append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return qt.startActiveSpan("drizzle.buildSQL",r=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return r?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,r){let n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{escapeName:o,escapeParam:c,prepareTyping:m,inlineParams:d,paramStartIndex:u}=n;return _r(e.map(s=>{if(b(s,x))return{sql:s.value.join(""),params:[]};if(b(s,P))return{sql:o(s.value),params:[]};if(s===void 0)return{sql:"",params:[]};if(Array.isArray(s)){let p=[new x("(")];for(let[g,de]of s.entries())p.push(de),g<s.length-1&&p.push(new x(", "));return p.push(new x(")")),this.buildQueryFromSourceParams(p,n)}if(b(s,v))return this.buildQueryFromSourceParams(s.queryChunks,{...n,inlineParams:d||s.shouldInlineParams});if(b(s,w)){let p=s[w.Symbol.Schema],g=s[w.Symbol.Name];return{sql:p===void 0?o(g):o(p)+"."+o(g),params:[]}}if(b(s,T))return{sql:o(s.table[w.Symbol.Name])+"."+o(s.name),params:[]};if(b(s,H)){let p=s[j].schema,g=s[j].name;return{sql:p===void 0?o(g):o(p)+"."+o(g),params:[]}}if(b(s,M)){let p=s.value===null?null:s.encoder.mapToDriverValue(s.value);if(b(p,v))return this.buildQueryFromSourceParams([p],n);if(d)return{sql:this.mapInlineParam(p,n),params:[]};let g;return m!==void 0&&(g=[m(s.encoder)]),{sql:c(u.value++,p),params:[p],typings:g}}return b(s,Q)?{sql:c(u.value++,s),params:[s]}:b(s,v.Aliased)&&s.fieldAlias!==void 0?{sql:o(s.fieldAlias),params:[]}:b(s,C)?s._.isWith?{sql:o(s._.alias),params:[]}:this.buildQueryFromSourceParams([new x("("),s._.sql,new x(") "),new P(s._.alias)],n):At(s)?s.schema?{sql:o(s.schema)+"."+o(s.enumName),params:[]}:{sql:o(s.enumName),params:[]}:Tr(s)?this.buildQueryFromSourceParams([new x("("),s.getSQL(),new x(")")],n):d?{sql:this.mapInlineParam(s,n),params:[]}:{sql:c(u.value++,s),params:[s]}}))}mapInlineParam(e,{escapeString:r}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return r(e);if(typeof e=="object"){let n=e.toString();return r(n==="[object Object]"?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new v.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}};i(v,Kt,"SQL");var h=v,Et;Et=l;var P=class{constructor(e){i(this,"brand");this.value=e}getSQL(){return new h([this])}};i(P,Et,"Name");var jt={mapFromDriverValue:t=>t},Mt={mapToDriverValue:t=>t},kn={...jt,...Mt},Ft;Ft=l;var M=class{constructor(e,r=Mt){i(this,"brand");this.value=e,this.encoder=r}getSQL(){return new h([this])}};i(M,Ft,"Param");function S(t,...e){let r=[];(e.length>0||t.length>0&&t[0]!=="")&&r.push(new x(t[0]));for(let[n,o]of e.entries())r.push(o,new x(t[n+1]));return new h(r)}(t=>{function e(){return new h([])}t.empty=e;function r(u){return new h(u)}t.fromList=r;function n(u){return new h([new x(u)])}t.raw=n;function o(u,s){let p=[];for(let[g,de]of u.entries())g>0&&s!==void 0&&p.push(s),p.push(de);return new h(p)}t.join=o;function c(u){return new P(u)}t.identifier=c;function m(u){return new Q(u)}t.placeholder=m;function d(u,s){return new M(u,s)}t.param=d})(S||(S={}));(t=>{var r;r=l;let n=class n{constructor(c,m){i(this,"isSelectionField",!1);this.sql=c,this.fieldAlias=m}getSQL(){return this.sql}clone(){return new n(this.sql,this.fieldAlias)}};i(n,r,"SQL.Aliased");let e=n;t.Aliased=e})(h||(h={}));var Lt;Lt=l;var Q=class{constructor(e){this.name=e}getSQL(){return new h([this])}};i(Q,Lt,"Placeholder");var Vt,Ot;Ot=l,Vt=j;var H=class{constructor({name:e,schema:r,selectedFields:n,query:o}){i(this,Vt);this[j]={name:e,originalName:e,schema:r,selectedFields:n,query:o,isExisting:!o,isAlias:!1}}getSQL(){return new h([this])}};i(H,Ot,"View");T.prototype.getSQL=function(){return new h([this])};w.prototype.getSQL=function(){return new h([this])};C.prototype.getSQL=function(){return new h([this])};var Qt,Ut,ee=class extends(Ut=y,Qt=l,Ut){constructor(e){super(e,"boolean","PgBoolean")}build(e){return new te(e,this.config)}};i(ee,Qt,"PgBooleanBuilder");var kt,Bt,te=class extends(Bt=f,kt=l,Bt){getSQLType(){return"boolean"}};i(te,kt,"PgBoolean");function _(t){return new ee(t)}var Yt,Rt,q=class extends(Rt=y,Yt=l,Rt){defaultNow(){return this.default(S`now()`)}};i(q,Yt,"PgDateColumnBaseBuilder");var Jt,Wt,re=class extends(Wt=y,Jt=l,Wt){constructor(e){super(e,"number","PgInteger")}build(e){return new ne(e,this.config)}};i(re,Jt,"PgIntegerBuilder");var Xt,Zt,ne=class extends(Zt=f,Xt=l,Zt){getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};i(ne,Xt,"PgInteger");function Pe(t){return new re(t)}var Gt,Ht,ie=class extends(Ht=y,Gt=l,Ht){constructor(e,r){super(e,"string","PgText"),this.config.enumValues=r.enum}build(e){return new oe(e,this.config)}};i(ie,Gt,"PgTextBuilder");var er,tr,oe=class extends(tr=f,er=l,tr){constructor(){super(...arguments);i(this,"enumValues",this.config.enumValues)}getSQLType(){return"text"}};i(oe,er,"PgText");function a(t,e={}){return new ie(t,e)}var rr,nr,se=class extends(nr=q,rr=l,nr){constructor(e,r,n){super(e,"date","PgTimestamp"),this.config.withTimezone=r,this.config.precision=n}build(e){return new ae(e,this.config)}};i(se,rr,"PgTimestampBuilder");var ir,or,ae=class extends(or=f,ir=l,or){constructor(r,n){super(r,n);i(this,"withTimezone");i(this,"precision");i(this,"mapFromDriverValue",r=>new Date(this.withTimezone?r:r+"+0000"));i(this,"mapToDriverValue",r=>r.toISOString());this.withTimezone=n.withTimezone,this.precision=n.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}};i(ae,ir,"PgTimestamp");var sr,ar,le=class extends(ar=q,sr=l,ar){constructor(e,r,n){super(e,"string","PgTimestampString"),this.config.withTimezone=r,this.config.precision=n}build(e){return new ce(e,this.config)}};i(le,sr,"PgTimestampStringBuilder");var lr,cr,ce=class extends(cr=f,lr=l,cr){constructor(r,n){super(r,n);i(this,"withTimezone");i(this,"precision");this.withTimezone=n.withTimezone,this.precision=n.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};i(ce,lr,"PgTimestampString");function D(t,e={}){return e.mode==="string"?new le(t,e.withTimezone??!1,e.precision):new se(t,e.withTimezone??!1,e.precision)}var ur,mr,ue=class extends(mr=y,ur=l,mr){constructor(e){super(e,"string","PgUUID")}defaultRandom(){return this.default(S`gen_random_uuid()`)}build(e){return new me(e,this.config)}};i(ue,ur,"PgUUIDBuilder");var dr,pr,me=class extends(pr=f,dr=l,pr){getSQLType(){return"uuid"}};i(me,dr,"PgUUID");function $(t){return new ue(t)}var Ar=Ct("platform_type",["social","web3","listen"]),Cr=V("users",{id:$("id").default(S`uuid_generate_v4()`).primaryKey().notNull()}),zi=V("artists",{id:$("id").default(S`uuid_generate_v4()`).primaryKey().notNull(),legacyId:a("legacy_id"),bandcamp:a("bandcamp"),facebook:a("facebook"),x:a("x"),soundcloud:a("soundcloud"),notes:a("notes"),patreon:a("patreon"),name:a("name"),instagram:a("instagram"),youtube:a("youtube"),youtubechannel:a("youtubechannel"),bio:a("bio"),lcname:a("lcname"),soundcloudId:Pe("soundcloudID"),spotify:a("spotify"),twitch:a("twitch"),imdb:a("imdb"),musicbrainz:a("musicbrainz"),wikidata:a("wikidata"),mixcloud:a("mixcloud"),facebookId:a("facebookID"),discogs:a("discogs"),tiktok:a("tiktok"),tiktokId:a("tiktokID"),jaxsta:a("jaxsta"),famousbirthdays:a("famousbirthdays"),songexploder:a("songexploder"),colorsxstudios:a("colorsxstudios"),bandsintown:a("bandsintown"),linktree:a("linktree"),onlyfans:a("onlyfans"),wikipedia:a("wikipedia"),audius:a("audius"),zora:a("zora"),catalog:a("catalog"),opensea:a("opensea"),foundation:a("foundation"),lastfm:a("lastfm"),linkedin:a("linkedin"),soundxyz:a("soundxyz"),mirror:a("mirror"),glassnode:a("glassnode"),collectsNfTs:_("collectsNFTs"),spotifyusername:a("spotifyusername"),bandcampfan:a("bandcampfan"),tellie:a("tellie"),wallets:a("wallets").array(),ens:a("ens"),lens:a("lens"),addedBy:$("added_by").notNull().default(S`uuid_generate_v4()`),cameo:a("cameo"),farcaster:a("farcaster"),supercollector:a("supercollector"),createdAt:D("created_at",{withTimezone:!0,mode:"string"}).defaultNow(),updatedAt:D("updated_at",{withTimezone:!0,mode:"string"}).default(S`(now() AT TIME ZONE 'utc'::text)`).notNull()},t=>({artistsAddedbyFkey:st({columns:[t.addedBy],foreignColumns:[Cr.id],name:"artists_addedby_fkey"})})),Ii=V("aiprompts",{id:$("prompt_id").primaryKey().defaultRandom(),promptName:a("prompt_name").default("unnamed_prompt"),promptBeforeName:a("prompt_before_name").notNull(),promptAfterName:a("prompt_after_name").notNull(),isDefault:_("is_default").default(!1),isEnabled:_("is_enabled").default(!1),createdAt:D("created_at").defaultNow()}),Pi=V("urlmap",{id:$("id").default(S`uuid_generate_v4()`).primaryKey().notNull(),siteUrl:a("site_url").notNull(),siteName:a("site_name").notNull(),example:a("example").notNull(),appStringFormat:a("app_string_format").notNull(),order:Pe("order"),isIframeEnabled:_("is_iframe_enabled").default(!1).notNull(),isEmbedEnabled:_("is_embed_enabled").default(!1).notNull(),cardDescription:a("card_description"),cardPlatformName:a("card_platform_name"),isWeb3Site:_("is_web3_site").notNull(),createdAt:D("created_at",{withTimezone:!0,mode:"string"}).default(S`(now() AT TIME ZONE 'utc'::text)`).notNull(),updatedAt:D("updated_at",{withTimezone:!0,mode:"string"}).default(S`(now() AT TIME ZONE 'utc'::text)`),siteImage:a("site_image"),regex:a("regex").default('""').notNull(),regexMatcher:a("regex_matcher"),isMonetized:_("is_monetized").default(!1).notNull(),regexOptions:a("regex_options").array(),platformTypeList:Ar("platform_type_list").array().default(["social"]),colorHex:a("color_hex").notNull()},t=>({urlmapSiteurlKey:O("urlmap_siteurl_key").on(t.siteUrl),urlmapSitenameKey:O("urlmap_sitename_key").on(t.siteName),urlmapExampleKey:O("urlmap_example_key").on(t.example),urlmapAppstingformatKey:O("urlmap_appstingformat_key").on(t.appStringFormat)}));function vr(){try{return chrome.runtime.id,!0}catch{return!1}}function A(){if(!("mediaSession"in navigator))return console.log("Media Session API not supported"),null;let t=navigator.mediaSession.metadata,e=navigator.mediaSession.playbackState;return e==="paused"?null:t?{title:t.title||"",channel:t.artist||"",album:t.album||"",source:"mediaSession",playbackState:e,url:window.location.href,domain:window.location.hostname}:(console.log("No useful media session data (no title or artist)"),null)}function fr(){if(!("mediaSession"in navigator))return;let t=null;setInterval(()=>{if(vr){let r=navigator.mediaSession.metadata,n=navigator.mediaSession.playbackState;JSON.stringify(r)!=JSON.stringify(t)&&n=="playing"?(t=JSON.stringify(r),chrome.runtime.sendMessage({action:"musicDetected",data:A()}),Oe()):(t=JSON.stringify(r),chrome.runtime.sendMessage({action:"musicPaused",data:A()}))}},3e3)}console.log("[YT-EXT] content script injected");fr();chrome.runtime.onMessage.addListener((t,e,r)=>{if(t.type==="GET_YT_INFO"){let n=K(location.href);if(!n)return r(null),!0;U(n).then(o=>r(o)).catch(o=>{console.error("[YT-EXT] Fetch error",o),r(null)})}return t.type==="SCRAPE_YT_INFO"&&r(qe()),!0});chrome.runtime.onMessage.addListener((t,e,r)=>{t.action==="checkMediaSession"&&r(A())});})();
